@using Origin.YMC.Business.Entities.Domain.QuestionsThreads.ViewModels
@using Microsoft.AspNet.Identity
@using Origin.YMC.Business.Components.Interfaces
@using Origin.YMC.CrossCutting.Framework.ServiceLocator
@using System.Globalization
@model QuestionViewModel
@{
    Layout = "~/Views/Shared/_Layout_blank_.cshtml";

}

<!-- #content start -->
<div id="content" class="content">
    <section class="wizard cardiology-section">
        <div class="container">
            <!-- .row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="top-thread-doctors box-shadow radius-border">
                        <div class="row">
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            @if (!string.IsNullOrWhiteSpace(Model.Doctor.ProfileImage))
                                            {
                                                <img src="@Model.Doctor.ProfileImage" class="mar-15 left img-responsive checked-image" alt="">
                                            }
                                            else
                                            {
                                                <img src="~/Content/img/v-person.png" class="mar-15 left img-responsive checked-image" alt="">
                                            }
                                            <h2 class="text-left blue-color-font text-uppercase submit-done-title bounceInDown wow">@Resources.GlobalStrings.Dr. @Model.Doctor.FirstName @Model.Doctor.LastName</h2>
                                            <span class="black-color-font text-uppercase submit-done-title-sub"> @Model.Doctor.SpecialtyName</span>
                                            <div>
                                                <label class="black-color-font mar-15"></label><span class="black-color-font"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-sm-2">
                                <div class="text-center hidden-mob">
                                    <div class="sep-sec">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            <img src="~/Content/img/v-person.png" class="mar-15 left img-responsive checked-image" alt="">
                                            <h2 class="text-left blue-color-font text-uppercase submit-done-title bounceInDown wow">@Model.Patient.FirstName @Model.Patient.LastName</h2>
                                            <span class="black-color-font text-uppercase submit-done-title-sub">@Model.Patient.CityName</span>
                                            <div>
                                                <label class="black-color-font mar-15"> </label><span class="black-color-font"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="wizard cardiology-section">
        <div class="container">
            <!-- .row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="top-thread-doctors box-shadow radius-border">
                        <div class="row">
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            <span class="black-color-font text-uppercase submit-done-title-sub">@Resources.GlobalStrings.Attached_files_to_see_click </span>
                                            <div>
                                                <label class="black-color-font mar-15"></label><span class="black-color-font"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-sm-2">
                                <div class="text-center hidden-mob">
                                    <div class="sep-sec">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            @foreach (var item in Model.CasseAttchment)
                                            {
                                                <a target="_blank" href="@item">@Resources.GlobalStrings.Click_Here</a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-12">
                    <div class="top-thread-doctors box-shadow radius-border">
                        <div class="row">
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            <span class="black-color-font text-uppercase submit-done-title-sub">@Resources.GlobalStrings.Attached_Interpretedfiles_to_see_click </span>
                                            <div>
                                                <label class="black-color-font mar-15"></label><span class="black-color-font"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-sm-2">
                                <div class="text-center hidden-mob">
                                    <div class="sep-sec">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5 col-sm-5">
                                <div class="text-center">
                                    <div class="amount-paid-container-done">
                                        <div class="text-left">
                                            @foreach (var item in Model.CasseAttchmentInterpreted)
                                            {
                                                <a target="_blank" href="@item">@Resources.GlobalStrings.Click_Here</a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="discussion-section">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <div class="discussion-big-container box-shadow radius-border margin-top-10">
                        <!-- discussion-content 1 -->
                        <div class="chat-content discussion-content active-content">
                            <div class="contact-post discussion-post">

                                @if (!string.IsNullOrWhiteSpace(Model.Doctor.ProfileImage))
                                {
                                    <img src="@Model.Doctor.ProfileImage" alt="">
                                }
                                else
                                {
                                    <img src="~/Content/img/v-person.png" alt="">
                                }
                                <p>
                                    <span class="discussion-owner discussion-owner-post">@Model.Doctor.FirstName @Model.Doctor.LastName</span>
                                    @Model.DoctorReportDiagnosis
                                </p>

                                <a href="#" class="report-btn"><img src="~/Content/img/report-btn-icon.png" class="report-btn-icon" alt=""><span>@Resources.GlobalStrings.Reply</span></a>
                            </div>
                            <div class="messages discussion-messages" style="display:block">
                                <ul>
                                    @foreach (var qus in Model.Questions)
                                    {
                                        <li class="replies discussion-replies">

                                            @if (!string.IsNullOrWhiteSpace(qus.ownerInfo.ProfileImage))
                                            {
                                                <img src="@qus.ownerInfo.ProfileImage" alt="">
                                            }
                                            else
                                            {
                                                <img src="~/Content/img/v-person.png" alt="">
                                            }
                                            <p>
                                                <span class="discussion-owner">@qus.ownerInfo.Name</span><span class="msg_time">@qus.CreationDate.ToString("yyyy-MM-dd HH:mm tt", new CultureInfo("en-US", true))</span>
                                                <span class="discussion-para">@qus.ChatText</span>
                                            </p>
                                        </li>
                                    }


                                </ul>
                            </div>
                            @*<div class="show-more-container discussion-more">
                                    <a href="#" class="show-more-btn"><i class="fa fa-caret-down"></i>show more</a>
                                </div>*@
                            <div class="message-input discussion-message-input" style="display:block">
                                <div class="wrap">
                                    <input @(  (Model.ClosureDate.HasValue && Model.ClosureDate.Value > DateTime.Now.ToUniversalTime().AddHours(2).AddHours(48)) ? "disabled":"") type="text" id="txtMessage" placeholder="@Resources.GlobalStrings.Write_your_message ...">
                                    <i class="fa fa-paperclip attachment" aria-hidden="true"></i>
                                    <button @(  (Model.ClosureDate.HasValue && Model.ClosureDate.Value > DateTime.Now.ToUniversalTime().AddHours(2).AddHours(48)) ? "style=pointer-events:none":"") onclick="addQuestionThread();" class="submit"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- social Links -->
    @Html.Partial("~/Views/Shared/_Partial/_SocialUrl.cshtml")
</div>
@section Scripts{
    <script src="~/Content/js/patient-profile.js"></script>
    <script>
        function addQuestionThread() {
            var _caseId = '@Model.CaseId';
            var _message = $("#txtMessage").val();
            @{
                var   _doctorServices = ServiceLocatorFactory.CreateServiceLocator().GetService<IDoctorComponent>();
                var   _patientServices = ServiceLocatorFactory.CreateServiceLocator().GetService<IPatientComponent>();

                var ownerType = 0;
                var ownerId = Guid.Empty;
                if (User.IsInRole("Doctor"))
                {
                    ownerType = 1;
                    ownerId = _doctorServices.GetDoctorId(Guid.Parse(User.Identity.GetUserId()));
                }
                else if (User.IsInRole("Patient"))
                {
                    ownerType = 2;
                    ownerId =  _patientServices.GetPatientId(Guid.Parse(User.Identity.GetUserId()));
                }

            }
            var _ownerType=@ownerType;
            var _ownerId='@ownerId';


            $("#loader").show();
            $.ajax({
                type: "post",
                url: '/QuestionThreads/AddQuestionThread',
                data: { CaseId:_caseId,ChatText:_message,OwnerType:_ownerType,OwnerId:_ownerId },
                dataType: 'json',
                traditional: true,
                success: function (data) {
                    $("#loader").hide();
                    location.reload();
                },
                onFailure: function (ex) {
                    alert(ex);
                }
            });
        }
    </script>
}
